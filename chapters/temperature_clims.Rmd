# Sea Surface Climatologies

**Description**: Comparison of temperature data with varying climatologies

**Found in**: 

**Indicator category**: 

**Contributor(s)**: Kim Bastille, Vince Saba, Hubert du Pontavice, Kim Hyde
  
**Data steward**: Kim Bastille
  
**Point of contact**: Kim Bastille
  
**Public availability statement**: 

## Impact Summary

Definiton of baseline climatology. pros and cons of shifting  

### Plotting

#### Sea Surface Temperatures 

```{r}
gom<-readxl::read_excel(here::here("data-raw/GOM_SST_1982_to_2021 - Vincent Saba - NOAA Federal.xlsx")) %>%
  dplyr::mutate(t = as.Date(t), 
                EPU = "GOM")
gb<-readxl::read_excel(here::here("data-raw/GB_SST_1982_to_2021 - Vincent Saba - NOAA Federal.xlsx")) %>%
  dplyr::mutate(t = as.Date(t), 
                EPU = "GB")
mab<-readxl::read_excel(here::here("data-raw/MAB_SST_1982_to_2021 - Vincent Saba - NOAA Federal.xlsx")) %>%
  dplyr::mutate(t = as.Date(t), 
                EPU = "MAB")

ltm8211<- rbind(gom,gb,mab) %>% 
  dplyr::mutate(Time = lubridate::year(t), 
                DOY = lubridate::yday(t)) %>% 
  dplyr::filter(Time %in% 1982:2011) %>% 
  dplyr::group_by(DOY, EPU) %>% 
  dplyr::summarise(ltm = mean(temp)) %>% 
  dplyr::mutate(Cat = "ltm 82-11")

ltm9120<- rbind(gom,gb,mab) %>% 
  dplyr::mutate(Time = lubridate::year(t), 
                DOY = lubridate::yday(t)) %>% 
  dplyr::filter(Time %in% 1991:2020) %>% 
  dplyr::group_by(DOY, EPU) %>% 
  dplyr::summarise(ltm = mean(temp)) %>% 
  dplyr::mutate(Cat = "ltm 91-20")

gom %>% rbind(gb,mab) %>% 
  dplyr::mutate(Time = lubridate::year(t), 
                DOY = lubridate::yday(t)) %>% 
  dplyr::filter(Time == 2021) %>%
  dplyr::mutate(Cat = "2021", 
                ltm = temp) %>% 
  dplyr::select(DOY, EPU, ltm, Cat) %>% 
  rbind(ltm8211, ltm9120) %>% 
  ggplot(aes(x = DOY, y = ltm, color = Cat), alpha = 0.7)+
  geom_line()+
  geom_point()+
  facet_wrap(EPU~.)+
  theme(legend.title = element_blank())+
  ylab("Temp C")

```


#### Seasonal Sea Surface Temperature Anomolies 

```{r}

new<- read.csv(here::here("data-raw/SST_ltm9220.csv")) %>% 
  #dplyr::filter(EPU == "MAB") %>% 
  dplyr::mutate(ltm = c("91-20")) %>% 
  dplyr::select(-X)
ecodata::seasonal_oisst_anom %>%
  dplyr::mutate(ltm = c("82-10")) %>% 
  #dplyr::filter(EPU  == "MAB") %>%
  rbind(new) %>% 
  tidyr::separate(Var, into = c("Var", "OI","SST", "anom")) %>% 
  dplyr::mutate(Var = recode(Var, "winter" = "Winter"), 
         Var = recode(Var, "spring" = "Spring"),
         Var = recode(Var, "summer" = "Summer"),
         Var = recode(Var, "fall" = "Fall")) %>% 
  ggplot()+
  geom_point(aes(x= Time, y = Value, color = ltm))+
  geom_line(aes(x= Time, y = Value, color = ltm))+
  ecodata::geom_gls(aes(x= Time, y = Value, color = ltm))+
  facet_grid(EPU~Var)+
  ecodata::theme_facet() +
  ggplot2::theme(strip.text=element_text(hjust=0),
                 plot.title = element_text(size = 12))+
  ecodata::theme_title()
```

#### GOM Marine Heatwave 2021


```{r, fig.cap="GOM heatwave presented in the 2022 SOE, uses clim of 82-11"}
ecodata::heatwave_year %>% 
  filter(EPU == "GOM", 
         str_detect(t, "2021")) %>% 
  ggplot( aes(x = t, y = temp))+
  heatwaveR::geom_flame(aes(y2 = thresh))+ 
  geom_line(aes(x = t, y = seas, color = "a"), size = 1)+
  geom_line(aes(x = t, y = thresh, color = "c"), size = 1)+
  geom_line(aes(x = t, y = temp, color = "b"))+
  scale_colour_manual(values = c("turquoise4", "sienna3", "black"),
                      labels = c("Climatology","Temperature", "Threshold"))+
  ylab("Temperature (C)")+
  xlab(element_blank())+
  scale_x_date(date_labels = "%b", breaks = "1 month")+
  theme_bw()+
  theme(legend.title = element_blank(),
        legend.position=c(0.2, 0.8))+
  ecodata::theme_title()



```



```{r, fig.cap="GOM heatwave uses clim of 91-20"}
gom<-read.csv(here::here("data-raw/heatwave_year_9120.csv"), header = TRUE) %>% 
  dplyr::filter(EPU == "GOM", 
         stringr::str_detect(t, "2021")) %>% 
  dplyr::mutate(date  = lubridate::as_date(t)) %>% 
  ggplot( aes(x = date, y = temp))+
  heatwaveR::geom_flame(aes(y2 = thresh))+ 
  geom_line(aes(x = date, y = seas, color = "a"), size = 1)+
  geom_line(aes(x = date, y = thresh, color = "c"), size = 1)+
  geom_line(aes(x = date, y = temp, color = "b"))+
  scale_colour_manual(values = c("turquoise4", "sienna3", "black"),
                      labels = c("Climatology","Temperature", "Threshold"))+
  ylab("Temperature (C)")+
  xlab(element_blank())+
  scale_x_date(date_labels = "%b", breaks = "1 month")+
  theme_bw()+
  theme(legend.title = element_blank(),
        legend.position=c(0.2, 0.8))+
  ecodata::theme_title()

gom
```

#### Cumulative and Maximum Marine Heatwaves

```{r, fig.cap=""}
cumu <- ecodata::heatwave %>% 
  dplyr::filter(Var == "cumulative intensity") %>% 
  dplyr::mutate(Var = recode(Var, "cumulative intensity" = "Cumulative Intensity (degree C x days)"))

maxin <- ecodata::heatwave %>% 
  dplyr::filter(Var == "maximum intensity") %>% 
  dplyr::group_by(Time, EPU, Var, Units) %>% 
  dplyr::summarise(Value = max(Value)) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(Var = recode(Var, "maximum intensity" = "Maximum Intensity (degree C)"))

hw<- cumu %>%
  rbind(maxin) %>% 
  dplyr::group_by(Var, EPU) %>% 
  dplyr::mutate(hline = mean(Value), 
                ltm = "82-11")

cumu9120 <- read.csv(here::here("data-raw/heatwave_9120.csv")) %>% 
  dplyr::filter(Var == "cumulative intensity") %>% 
  dplyr::mutate(Var = recode(Var, "cumulative intensity" = "Cumulative Intensity (degree C x days)")) %>% 
  dplyr::select(!X)

maxin9120 <- read.csv(here::here("data-raw/heatwave_9120.csv")) %>% 
  dplyr::filter(Var == "maximum intensity") %>% 
  dplyr::group_by(Time, EPU, Var, Units) %>% 
  dplyr::summarise(Value = max(Value)) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(Var = recode(Var, "maximum intensity" = "Maximum Intensity (degree C)"))

hw9120<- cumu9120 %>%
  rbind(maxin9120) %>% 
  dplyr::group_by(Var, EPU) %>% 
  dplyr::mutate(hline = mean(Value), 
                ltm = "91-20", 
                Time = as.numeric(Time))

hw %>% rbind(hw9120) %>%  
  ggplot2::ggplot() +
  ggplot2::annotate("rect", fill = shade.fill, alpha = shade.alpha,
                    xmin = x.shade.min , xmax = x.shade.max,
                    ymin = -Inf, ymax = Inf) +
  ggplot2::geom_line(aes(x = Time, y = Value, color = ltm)) +
  ggplot2::geom_point(aes(x = Time, y = Value, color = ltm)) +
  ecodata::geom_gls(aes(x = Time, y = Value, color = ltm)) +
  #ecodata::geom_gls(aes(x= Time, y = Value))+
  ggplot2::ylab("") +
  ggplot2::xlab(element_blank())+
  ggplot2::ggtitle("Cumulative and Maximum Heatwaves") +
  ggplot2::scale_x_continuous(expand = c(0.01, 0.01))+
  ggplot2::geom_hline(aes(yintercept = hline),
                      size = hline.size,
                      alpha = hline.alpha,
                      linetype = hline.lty)+
  ggplot2::facet_grid(Var~EPU, scales = "free") +
  ecodata::theme_ts()+
  ggplot2::theme(strip.text=element_text(hjust=0,
                                         face = "italic"), 
                 axis.title.y = element_text(angle = 90))+
  ecodata::theme_title()
```


